<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Light Sync</title>
    <link rel="icon" type="image/png" href="carlightsync64.png">
    <link href="style.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <img src="carlightsync64.png" alt="Car Light Sync Logo">
            </div>
            <div class="header-content">
                <h1 data-i18n="app.title">Car Light Sync</h1>
                <p data-i18n="app.subtitle">Contrôle RGB synchronisé avec votre voiture</p>
            </div>
            <div class="header-controls">
                <div class="header-control">
                    <label for="language-select" data-i18n="config.language">Langue</label>
                    <select id="language-select" onchange="setLanguage(this.value)">
                        <option value="fr" data-i18n="config.languageFrench">Français</option>
                        <option value="en" data-i18n="config.languageEnglish">English</option>
                    </select>
                </div>
                <div class="header-control">
                    <label for="theme-select" data-i18n="config.theme">Thème</label>
                    <select id="theme-select" onchange="setTheme(this.value)">
                        <option value="dark" data-i18n="config.themeDark">Mode sombre</option>
                        <option value="light" data-i18n="config.themeLight">Mode clair</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="ble-notification" class="notification"></div>
        <div class="status-bar">
            <div id="ble-status-item" class="status-item status-item-ble" hidden>
              <button id="ble-connect-button" class="btn-secondary ble-icon-button" onclick="toggleBleConnection()" title="BLE"></button>
              <div class="status-item">
                  <div class="status-label" data-i18n="ble.title">Connexion BLE</div>
                  <div class="status-value" id="ble-status-text" data-i18n="ble.disconnected">Déconnecté</div>
                </div>
            </div>
            <div id="wifi-status-item"  class="status-item">
                <div class="status-label" data-i18n="status.wifi">WiFi</div>
                <div class="status-value" id="wifi-status">...</div>
            </div>
            <div class="status-item">
                <div class="status-label" data-i18n="status.can-bus">CAN Bus</div>
                <div class="status-value" id="can-bus-status">...</div>
            </div>
            <div class="status-item">
                <div class="status-label" data-i18n="status.vehicle">Véhicule</div>
                <div class="status-value" id="vehicle-status">...</div>
            </div>
            <div class="status-item">
                <div class="status-label" data-i18n="status.profile">Profil</div>
                <div class="status-value" id="profile-status">...</div>
            </div>
        </div>
        <div id="app-wrapper" class="app-wrapper">
            <div id="connection-overlay" class="connection-overlay">
                <div id="connection-overlay-message" class="overlay-content" data-i18n="app.waitingConnection">Connectez-vous en WiFi ou BLE pour continuer.</div>
            </div>
            <div id="app-content" class="app-content disabled">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" data-tab="vehicle" onclick="switchTab('vehicle', event)" data-i18n="tabs.vehicle">Véhicule</button>
          <button class="tab" data-tab="profiles" onclick="switchTab('profiles', event)" data-i18n="tabs.profiles">Profils</button>
          <button class="tab" data-tab="events-config" onclick="switchTab('events-config', event)" data-i18n="tabs.eventsConfig">Événements</button>
          <button class="tab" data-tab="simulation" onclick="switchTab('simulation', event)" data-i18n="tabs.simulation">Simulation</button>
          <button class="tab" data-tab="config" onclick="switchTab('config', event)" data-i18n="tabs.config">Configuration</button>
          <button class="tab" data-tab="ota" onclick="switchTab('ota', event)" data-i18n="tabs.ota">Mise à Jour</button>
        </div>
        <!-- Tab: Véhicule -->
        <div id="vehicle-tab" class="tab-content active">
            <div class="section-title" data-i18n="vehicle.title">Données Véhicule</div>
            <!-- Section: État général -->
            <div class="section-subtitle" data-i18n="vehicle.generalState">État Général</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.speed">Vitesse</div>
                    <div class="vehicle-value" id="v-speed">-- km/h</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.gear">Position de transmission</div>
                    <div class="vehicle-value" id="v-gear">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.brake">Frein</div>
                    <div class="vehicle-value" id="v-brake">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.locked">Verrouillé</div>
                    <div class="vehicle-value" id="v-locked">--</div>
                </div>
            </div>
            <!-- Section: Portes -->
            <div class="section-subtitle" data-i18n="vehicle.doorsTitle">Portes</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.doorFL">AV Gauche</div>
                    <div class="vehicle-value" id="v-door-fl">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.doorFR">AV Droite</div>
                    <div class="vehicle-value" id="v-door-fr">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.doorRL">AR Gauche</div>
                    <div class="vehicle-value" id="v-door-rl">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.doorRR">AR Droite</div>
                    <div class="vehicle-value" id="v-door-rr">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.trunk">Coffre</div>
                    <div class="vehicle-value" id="v-trunk">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.frunk">Frunk</div>
                    <div class="vehicle-value" id="v-frunk">--</div>
                </div>
            </div>
            <!-- Section: Charge -->
            <div class="section-subtitle" data-i18n="vehicle.chargeTitle">Charge</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.charging">En Charge</div>
                    <div class="vehicle-value" id="v-charging">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.chargePercent">Niveau</div>
                    <div class="vehicle-value" id="v-charge">--%</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.chargePower">Puissance</div>
                    <div class="vehicle-value" id="v-charge-power">-- kW</div>
                </div>
            </div>
            <!-- Section: Lumières -->
            <div class="section-subtitle" data-i18n="vehicle.lightsTitle">Lumières</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.headlights">Phares</div>
                    <div class="vehicle-value" id="v-headlights">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.highBeams">Feux Route</div>
                    <div class="vehicle-value" id="v-high-beams">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.fogLights">Anti-brouillard</div>
                    <div class="vehicle-value" id="v-fog-lights">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.turnSignal">Clignotant</div>
                    <div class="vehicle-value" id="v-turn-signal">--</div>
                </div>
            </div>
            <!-- Section: Autres -->
            <div class="section-subtitle" data-i18n="vehicle.othersTitle">Autres</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.batterylv">Batterie LV</div>
                    <div class="vehicle-value" id="v-battery-lv">-- V</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.batteryhv">Batterie HV</div>
                    <div class="vehicle-value" id="v-battery-hv">-- V</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.odometer">Odomètre</div>
                    <div class="vehicle-value" id="v-odometer">-- km</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.nightMode">Mode Nuit</div>
                    <div class="vehicle-value" id="v-night">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.brightness">Luminosité</div>
                    <div class="vehicle-value" id="v-brightness">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.blindspotLeft_lv1">Angle Mort G Niv1</div>
                    <div class="vehicle-value" id="v-blindspot-left-lv1">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.blindspotLeft_lv2">Angle Mort G Niv2</div>
                    <div class="vehicle-value" id="v-blindspot-left-lv2">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.blindspotRight_lv1">Angle Mort D Niv1</div>
                    <div class="vehicle-value" id="v-blindspot-right-lv1">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.blindspotRight_lv2">Angle Mort D Niv2</div>
                    <div class="vehicle-value" id="v-blindspot-right-lv2">--</div>
                </div>
            </div>
            <div class="section-subtitle" data-i18n="vehicle.sentryTitle">Mode Sentry</div>
            <div class="vehicle-grid">
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.sentryMode">État UI</div>
                    <div class="vehicle-value" id="v-sentry-mode">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.sentryRequest">Requête Autopilot</div>
                    <div class="vehicle-value" id="v-sentry-request">--</div>
                </div>
                <div class="vehicle-item">
                    <div class="vehicle-label" data-i18n="vehicle.sentryAlert">Alerte</div>
                    <div class="vehicle-value" id="v-sentry-alert">--</div>
                </div>
            </div>
        </div>
        </div>
        <!-- Tab: Profils -->
        <div id="profiles-tab" class="tab-content">
            <div class="section-title" data-i18n="profiles.title">Gestion des Profils</div>
            <div id="profiles-notification" class="notification"></div>
            <div class="control-group">
                <label class="control-label" data-i18n="profiles.activeProfile">Profil Actif</label>
                <select id="profile-select" onchange="activateProfile()">
                    <option value="-1" data-i18n="profiles.loading">Chargement...</option>
                </select>
            </div>
            <!-- <button class="btn-primary" onclick="activateProfile()" data-i18n="profiles.activate">Activer</button> -->
            <button class="btn-secondary" onclick="showNewProfileDialog()" data-i18n="profiles.new">Nouveau</button>
            <button class="btn-danger" onclick="deleteProfile()" data-i18n="profiles.delete">Supprimer</button>
            <button class="btn-secondary" onclick="exportProfile()" data-i18n="profiles.export">Exporter</button>
            <button class="btn-secondary" onclick="showImportDialog()" data-i18n="profiles.import">Importer</button>
            <div class="checkbox-container" style="margin-top: 20px;">
                <input type="checkbox" id="auto-night-mode">
                <label for="auto-night-mode" data-i18n="profiles.autoNightMode">Mode nuit automatique (basé sur CAN)</label>
            </div>
            <div class="control-group" style="margin-top: 10px;">
                <label class="control-label" data-i18n="profiles.nightBrightness">Luminosité Mode Nuit</label>
                <div class="slider-container">
                    <input type="range" id="night-brightness-slider" min="0" max="100" value="12">
                    <span class="slider-value" id="night-brightness-value">12%</span>
                </div>
            </div>
            <div class="section" style="margin-top: 30px;">
                <div class="section-title" style="font-size: 16px;" data-i18n="profiles.defaultEffect">Effet par Défaut</div>
                <p style="margin-bottom: 15px; color: var(--color-muted); font-size: 14px;" data-i18n="profiles.defaultEffectDesc">
                    Configurez l'effet affiché lorsqu'aucun événement CAN n'est actif.
                </p>
                <div class="control-group">
                    <label class="control-label" data-i18n="effects.effect">Effet</label>
                    <select id="default-effect-select" data-effect-options="true">
                            <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="control-group">
                    <label class="control-label" data-i18n="effects.brightness">Luminosité</label>
                    <div class="slider-container">
                        <input type="range" id="default-brightness-slider" min="0" max="100" value="50">
                        <span class="slider-value" id="default-brightness-value">50%</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" data-i18n="effects.speed">Vitesse</label>
                    <div class="slider-container">
                        <input type="range" id="default-speed-slider" min="0" max="100" value="50">
                        <span class="slider-value" id="default-speed-value">50%</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" data-i18n="effects.color">Couleur</label>
                    <input type="color" id="default-color1" value="#ff0000">
                </div>
                <div class="checkbox-container" style="margin-top: 15px;">
                    <input type="checkbox" id="default-audio-reactive">
                    <label for="default-audio-reactive" data-i18n="effects.audioReactiveMode">Mode Audio Réactif</label>
                </div>
            </div>
        </div>
        <!-- Tab: Events Configuration -->
        <div id="events-config-tab" class="tab-content">
            <div class="section-title" data-i18n="eventsConfig.title">Configuration des Événements</div>
            <div id="events-notification" class="notification"></div>
            <div id="events-loading" class="loading" data-i18n="eventsConfig.loading">Chargement de la configuration...</div>
            <div id="events-content" style="display: none;">
                <p style="margin-bottom: 20px; color: var(--color-muted); font-size: 14px;" data-i18n="eventsConfig.description">
                    Configurez les effets lumineux pour chaque événement CAN détecté par le véhicule.
                </p>
                <div class="events-table-wrapper">
                    <div class="events-table-container">
                        <table class="events-table">
                            <thead>
                                <tr>
                                    <th data-i18n="eventsConfig.eventName">Événement</th>
                                    <th data-i18n="eventsConfig.action">Action</th>
                                    <th data-i18n="eventsConfig.profile">Profil</th>
                                    <th data-i18n="eventsConfig.effect">Effet</th>
                                    <th data-i18n="eventsConfig.brightness">Luminosité</th>
                                    <th data-i18n="eventsConfig.speed">Vitesse</th>
                                    <th data-i18n="eventsConfig.color">Couleur</th>
                                    <th data-i18n="eventsConfig.duration">Durée (ms)</th>
                                    <th data-i18n="eventsConfig.priority">Priorité</th>
                                    <th data-i18n="eventsConfig.enabled">Activé</th>
                                </tr>
                            </thead>
                            <tbody id="events-table-body">
                                <!-- Will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <button class="btn-secondary" onclick="loadEventsConfig()" data-i18n="eventsConfig.reload">Recharger</button>
            </div>
        </div>
        <!-- Tab: Simulation -->
        <div id="simulation-tab" class="tab-content">
            <div class="section-title" data-i18n="simulation.title">Simulation d'Événements CAN</div>
            <div id="simulation-notification" class="notification"></div>
            <p style="margin-bottom: 20px; color: var(--color-muted); font-size: 14px;" data-i18n="simulation.description">
                Testez les effets lumineux en simulant des événements CAN sans connexion au véhicule.
            </p>
            <div id="simulation-sections"></div>
            <div class="section">
                <div class="section-title" style="font-size: 16px;" data-i18n="simulation.nightMode">Mode Nuit</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div class="event-toggle-container" id="event-toggle-nightmode">
                        <label class="event-toggle-label" for="toggle-nightmode" data-i18n="simulation.nightModeToggle">Mode Nuit</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-nightmode" onchange="toggleNightMode(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tab: Configuration -->
        <div id="config-tab" class="tab-content">
            <div class="section-title" data-i18n="config.title">Configuration Matérielle</div>
            <div id="config-notification" class="notification"></div>
            <p style="margin-bottom: 20px; color: var(--color-muted); font-size: 14px;" data-i18n="config.description">
                Configurez les paramètres matériels du contrôleur LED.
            </p>
            <div class="control-group">
                <label class="control-label" data-i18n="config.ledCount">Nombre de LEDs</label>
                <input type="number" id="led-count" value="" min="1" max="1000">
            </div>
            <div class="control-group">
                <label class="control-label" data-i18n="config.dataPin">Pin de Données</label>
                <input type="number" id="data-pin" value="" min="0" max="39">
            </div>
            <div class="checkbox-container" style="margin-top: 20px;">
                <input type="checkbox" id="strip-reverse">
                <label for="strip-reverse" data-i18n="config.stripReverse">Inverser le sens de la strip LED</label>
            </div>
            <button class="btn-primary" onclick="saveHardwareConfig()" data-i18n="config.save">Sauvegarder</button>
            <button class="btn-secondary" onclick="loadHardwareConfig()" data-i18n="config.reload">Recharger</button>
            <button class="btn-danger" style="margin-left: 10px;" onclick="restartDevice()" data-i18n="config.restartEsp">Redémarrer</button>

            <!-- Section Audio (Micro INMP441) -->
            <div class="section" style="margin-top: 40px; border-top: 2px solid var(--color-border); padding-top: 20px;">
                <div class="section-title" data-i18n="audio.title">Configuration Audio</div>
                <p style="margin-bottom: 15px; padding: 10px; background: rgba(250, 204, 21, 0.1); border-left: 3px solid #FACC15; font-size: 13px; color: var(--color-text);" data-i18n="audio.warning">
                    ⚠️ Le micro ne peut être activé que sur l'effet par défaut du profil actif.
                </p>

                <div class="checkbox-container" style="margin-bottom: 20px;">
                    <input type="checkbox" id="audio-enable" onchange="toggleAudio(this.checked)">
                    <label for="audio-enable" data-i18n="audio.enable">Activer le micro</label>
                    <span id="audio-status" style="margin-left: 10px; font-weight: bold; color: var(--color-muted);" data-i18n="audio.disabled">Désactivé</span>
                </div>

                <div id="audio-settings" style="display: none;">
                    <div class="control-group">
                        <label class="control-label" data-i18n="audio.sensitivity">Sensibilité</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="range" id="audio-sensitivity" min="0" max="255" value="128" oninput="updateAudioValue('sensitivity', this.value)" style="flex: 1;">
                            <span id="audio-sensitivity-value" style="min-width: 40px; font-weight: bold;">128</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label" data-i18n="audio.gain">Gain</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="range" id="audio-gain" min="0" max="255" value="128" oninput="updateAudioValue('gain', this.value)" style="flex: 1;">
                            <span id="audio-gain-value" style="min-width: 40px; font-weight: bold;">128</span>
                        </div>
                    </div>

                    <div class="checkbox-container">
                        <input type="checkbox" id="audio-auto-gain">
                        <label for="audio-auto-gain" data-i18n="audio.autoGain">Gain automatique</label>
                    </div>

                    <div id="audio-data" class="section" style="margin-top: 20px; padding: 15px; background: var(--color-panel); border-radius: 6px;">
                        <h4 style="margin: 0 0 15px 0;" data-i18n="audio.liveData">Données en Direct</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 14px;">
                            <div>
                                <span data-i18n="audio.amplitude">Amplitude</span>:
                                <strong id="audio-amplitude-value">-</strong>
                            </div>
                            <div>
                                <span data-i18n="audio.bpm">BPM</span>:
                                <strong id="audio-bpm-value">-</strong>
                            </div>
                            <div>
                                <span data-i18n="audio.bass">Basses</span>:
                                <strong id="audio-bass-value">-</strong>
                            </div>
                            <div>
                                <span data-i18n="audio.mid">Médiums</span>:
                                <strong id="audio-mid-value">-</strong>
                            </div>
                            <div>
                                <span data-i18n="audio.treble">Aigus</span>:
                                <strong id="audio-treble-value">-</strong>
                            </div>
                        </div>
                    </div>

                    <!-- FFT Advanced Mode -->
                    <div id="audio-fft-data" class="section" style="margin-top: 30px;">
                        <div class="section-title" data-i18n="fft.title">🎼 FFT Advanced Spectrum Analysis</div>

                        <div style="background: var(--color-info); padding: 10px 15px; border-radius: 6px; margin-bottom: 15px;">
                            <small style="color: var(--color-text);" data-i18n="fft.autoInfo">
                                ℹ️ Le FFT s'active automatiquement avec les effets audio-réactifs
                            </small>
                        </div>

                        <div id="fftStatusBox" style="display: none; margin-top: 10px;">
                            <div style="background: var(--color-surface); padding: 15px; border-radius: 8px; border: 1px solid var(--color-border);">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                    <div>
                                        <span data-i18n="fft.peakFreq">Fréquence dominante</span>:
                                        <strong id="fftPeakFreq" style="color: #4CAF50;">-</strong> Hz
                                    </div>
                                    <div>
                                        <span data-i18n="fft.centroid">Centroïde spectral</span>:
                                        <strong id="fftCentroid" style="color: #2196F3;">-</strong> Hz
                                    </div>
                                </div>
        
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                    <div>
                                        <span data-i18n="fft.kick">Kick</span>:
                                        <strong id="fftKick">-</strong>
                                    </div>
                                    <div>
                                        <span data-i18n="fft.snare">Snare</span>:
                                        <strong id="fftSnare">-</strong>
                                    </div>
                                    <div>
                                        <span data-i18n="fft.vocal">Vocal</span>:
                                        <strong id="fftVocal">-</strong>
                                    </div>
                                </div>
        
                                <!-- Canvas pour visualisation spectre -->
                                <div style="margin-top: 15px;">
                                    <div style="font-weight: 500; margin-bottom: 8px;" data-i18n="fft.spectrum">Spectre FFT (32 bandes)</div>
                                    <canvas id="fftSpectrumCanvas" width="600" height="200" style="width: 100%; max-width: 600px; background: #000; border-radius: 4px; border: 1px solid var(--color-border);"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="saveAudioConfig()" style="margin-top: 15px;" data-i18n="audio.saveConfig">Sauvegarder Configuration</button>
                </div>
            </div>


            <div class="section" style="margin-top: 40px; border-top: 2px solid #E82127; padding-top: 20px;">
                <div class="section-title" style="color: #E82127;" data-i18n="config.dangerZone">Zone Dangereuse</div>
                <p style="margin-bottom: 15px; color: var(--color-muted); font-size: 14px;" data-i18n="config.factoryResetWarning">
                    La réinitialisation usine supprimera TOUS les profils et configurations. Cette action est irréversible !
                </p>
                <button class="btn-danger" onclick="confirmFactoryReset()" data-i18n="config.factoryReset">Réinitialisation Usine</button>
            </div>
        </div>
        <!-- Tab: OTA -->
        <div id="ota-tab" class="tab-content">
            <div class="section-title" data-i18n="ota.title">Mise à Jour OTA</div>
            <div id="ota-notification" class="notification"></div>
            <div class="control-group">
                <label class="control-label" data-i18n="ota.currentVersion">Version Actuelle</label>
                <div style="padding: 12px; background: var(--color-panel); border-radius: 4px; font-weight: bold; border: 1px solid var(--color-input-border);" id="ota-version">
                    <span data-i18n="ota.loading">Chargement...</span>
                </div>
            </div>
            <div id="ota-progress-title" class="control-group" style="display: none;">
                <label class="control-label" data-i18n="ota.firmwareFile">Fichier Firmware (.bin)</label>
                <input type="file" id="firmware-file" accept=".bin">
            </div>
            <div id="ota-progress-container" style="display: none; margin-top: 15px;">
                <div style="background: var(--color-panel); border-radius: 4px; padding: 15px; border: 1px solid var(--color-input-border);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span data-i18n="ota.progress">Progression</span>
                        <span id="ota-progress-percent" style="font-weight: bold;">0%</span>
                    </div>
                    <div style="background: var(--color-input-border); height: 8px; border-radius: 4px; overflow: hidden;">
                        <div id="ota-progress-bar" style="background: #E82127; height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <div id="ota-status-message" style="margin-top: 10px; font-size: 14px; color: var(--color-muted);"></div>
                    <div id="ota-reboot-countdown" style="margin-top: 6px; font-size: 14px; color: #FACC15; display: none;"></div>
                </div>
            </div>
            <button class="btn-primary" onclick="uploadFirmware()" id="ota-upload-btn" data-i18n="ota.upload">Téléverser</button>
            <button class="btn-secondary" onclick="restartDevice()" id="ota-restart-btn" style="display: none;" data-i18n="ota.restart">Redémarrer</button>
            <div id="ota-ble-note" style="display: none; margin-top: 12px; font-size: 14px; color: #FACC15;" data-i18n="ota.bleNote">
                Connectez-vous au Wi-Fi de l'appareil (AP) pour effectuer la mise à jour.
            </div>
        </div>
    </div>
    <!-- Modal pour nouveau profil -->
    <div id="newProfileModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;" data-i18n="profiles.newProfileTitle">Nouveau Profil</h3>
            <input type="text" id="new-profile-name" data-i18n-placeholder="profiles.profileName" placeholder="Nom du profil" style="margin-bottom: 20px;">
            <button class="btn-primary" onclick="createProfile()" data-i18n="profiles.create">Créer</button>
            <button class="btn-secondary" onclick="hideNewProfileDialog()" data-i18n="profiles.cancel">Annuler</button>
        </div>
    </div>
    </div>
    </div>
</div>
</body>
<script src="i18n.js"></script>
<script src="script.js"></script>
</html>





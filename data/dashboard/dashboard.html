<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Car Light Sync - Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script>
        // Load i18n.js with correct path depending on context
        const i18nPath = window.Capacitor?.isNativePlatform() ? '/i18n.js' : '../i18n.js';
        document.write('<script src="' + i18nPath + '"><\/script>');
    </script>
    <style>
        /* Force landscape orientation hint */
        @media screen and (orientation: portrait) {
            body::before {
                content: attr(data-rotate-text);
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 9999;
                text-align: center;
                font-size: 18px;
                font-weight: bold;
            }
            #dashboard-container {
                filter: blur(5px);
                pointer-events: none;
            }
        }
    </style>
</head>
<body>
    <div id="dashboard-container">
        <!-- Header avec contrôles -->
        <div class="dashboard-header">
            <div class="connection-status" id="connection-status">
                <span class="status-dot" id="status-dot"></span>
                <span class="status-text" id="status-text" data-i18n="dashboard.disconnected">Déconnecté</span>
                <div class="connection-progress" id="connection-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span class="progress-text" id="progress-text"></span>
                </div>
            </div>
            <button class="config-btn" id="config-btn">⚙️ <span data-i18n="dashboard.config">Config</span></button>
        </div>

        <!-- Main content wrapper -->
        <div class="dashboard-content">
            <!-- PARK MODE -->
            <div class="park-mode active" id="park-mode">
                <!-- Left panel - Main info -->
                <div class="left-panel">
                    <!-- Battery & Charging -->
                    <div class="main-gauges">
                        <div class="gauge-container">
                            <div class="gauge battery-gauge">
                                <!-- Battery icon with progress bar -->
                                <div class="battery-icon-container">
                                    <svg class="battery-icon" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
                                        <!-- Battery outline -->
                                        <rect x="5" y="10" width="80" height="30" rx="3" fill="none" stroke="var(--text-tertiary)" stroke-width="2"/>
                                        <!-- Battery terminal (positive) -->
                                        <rect x="85" y="18" width="5" height="14" rx="1" fill="var(--text-tertiary)"/>
                                        <!-- Battery fill (progress bar) -->
                                        <rect id="battery-fill-park" x="8" y="13" width="74" height="24" rx="2" fill="#48bb78" class="battery-fill"/>
                                    </svg>
                                </div>
                                <div class="gauge-value" id="battery-value-park">0</div>
                                <div class="gauge-unit">%</div>
                                <div class="gauge-subtext" id="battery-voltage-park">0.0V</div>
                            </div>
                        </div>
                        <div class="gauge-container" id="charging-gauge-park" style="display: none;">
                            <div class="gauge speed-gauge">
                                <div class="gauge-value" id="charge-power-park">0.0</div>
                                <div class="gauge-unit">kW</div>
                                <div class="gauge-subtext">Charge</div>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle info -->
                    <div class="vehicle-info">
                        <div class="info-row">
                            <span class="info-label" data-i18n="dashboard.odometer">Odomètre</span>
                            <span class="info-value" id="odometer-value-park">0 km</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label" data-i18n="dashboard.batteryLV">Batterie LV</span>
                            <span class="info-value" id="battery-lv-park">0.0V</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label" data-i18n="dashboard.state">État</span>
                            <span class="info-value" id="gear-display-park">P</span>
                        </div>
                    </div>
                </div>

                <!-- Right panel - Vehicle Top View -->
                <div class="right-panel">
                    <div class="vehicle-top-view">
                        <svg class="vehicle-svg" viewBox="0 0 300 500" xmlns="http://www.w3.org/2000/svg">
                            <!-- Vehicle body outline -->
                            <g id="vehicle-body">
                                <!-- Main body -->
                                <rect x="80" y="120" width="140" height="260" rx="15" fill="var(--surface-secondary)" stroke="var(--surface-tertiary)" stroke-width="2"/>

                                <!-- Windshield (front) -->
                                <path d="M 90 120 L 90 140 L 210 140 L 210 120" fill="rgba(100, 150, 200, 0.3)" stroke="var(--surface-tertiary)" stroke-width="1"/>

                                <!-- Rear window -->
                                <path d="M 90 360 L 90 340 L 210 340 L 210 360" fill="rgba(100, 150, 200, 0.3)" stroke="var(--surface-tertiary)" stroke-width="1"/>

                                <!-- Hood lines -->
                                <line x1="100" y1="100" x2="100" y2="120" stroke="var(--surface-tertiary)" stroke-width="1"/>
                                <line x1="200" y1="100" x2="200" y2="120" stroke="var(--surface-tertiary)" stroke-width="1"/>

                                <!-- Trunk lines -->
                                <line x1="100" y1="380" x2="100" y2="400" stroke="var(--surface-tertiary)" stroke-width="1"/>
                                <line x1="200" y1="380" x2="200" y2="400" stroke="var(--surface-tertiary)" stroke-width="1"/>
                            </g>

                            <!-- FRUNK (front trunk) -->
                            <g id="frunk" class="vehicle-part">
                                <rect x="90" y="80" width="120" height="35" rx="8" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="frunk-door"/>
                                <circle cx="150" cy="97" r="8" fill="var(--surface-tertiary)" class="frunk-handle"/>
                            </g>

                            <!-- TRUNK (rear) -->
                            <g id="trunk" class="vehicle-part">
                                <rect x="90" y="385" width="120" height="35" rx="8" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="trunk-door"/>
                                <circle cx="150" cy="402" r="8" fill="var(--surface-tertiary)" class="trunk-handle"/>
                            </g>

                            <!-- DOOR FRONT LEFT -->
                            <g id="door-fl" class="vehicle-part">
                                <rect x="40" y="140" width="35" height="80" rx="5" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="door-fl"/>
                                <circle cx="70" cy="180" r="4" fill="var(--surface-tertiary)" class="door-handle"/>
                            </g>

                            <!-- DOOR FRONT RIGHT -->
                            <g id="door-fr" class="vehicle-part">
                                <rect x="225" y="140" width="35" height="80" rx="5" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="door-fr"/>
                                <circle cx="230" cy="180" r="4" fill="var(--surface-tertiary)" class="door-handle"/>
                            </g>

                            <!-- DOOR REAR LEFT -->
                            <g id="door-rl" class="vehicle-part">
                                <rect x="40" y="280" width="35" height="80" rx="5" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="door-rl"/>
                                <circle cx="70" cy="320" r="4" fill="var(--surface-tertiary)" class="door-handle"/>
                            </g>

                            <!-- DOOR REAR RIGHT -->
                            <g id="door-rr" class="vehicle-part">
                                <rect x="225" y="280" width="35" height="80" rx="5" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="door-rr"/>
                                <circle cx="230" cy="320" r="4" fill="var(--surface-tertiary)" class="door-handle"/>
                            </g>

                            <!-- HEADLIGHTS (front) -->
                            <g id="headlights">
                                <ellipse cx="105" cy="95" rx="12" ry="8" fill="var(--surface-tertiary)" class="headlight-left"/>
                                <ellipse cx="195" cy="95" rx="12" ry="8" fill="var(--surface-tertiary)" class="headlight-right"/>
                            </g>

                            <!-- TAIL LIGHTS (rear) -->
                            <g id="taillights">
                                <ellipse cx="105" cy="405" rx="10" ry="6" fill="var(--surface-tertiary)" class="taillight-left"/>
                                <ellipse cx="195" cy="405" rx="10" ry="6" fill="var(--surface-tertiary)" class="taillight-right"/>
                            </g>

                            <!-- TURN SIGNALS -->
                            <g id="turn-signals">
                                <!-- Front left -->
                                <circle cx="85" cy="115" r="6" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="1" class="turn-signal-fl"/>
                                <!-- Front right -->
                                <circle cx="215" cy="115" r="6" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="1" class="turn-signal-fr"/>
                                <!-- Rear left -->
                                <circle cx="85" cy="385" r="6" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="1" class="turn-signal-rl"/>
                                <!-- Rear right -->
                                <circle cx="215" cy="385" r="6" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="1" class="turn-signal-rr"/>
                            </g>

                            <!-- CHARGING PORT (left side, front) -->
                            <g id="charging-port">
                                <circle cx="75" cy="160" r="8" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="charge-port"/>
                                <path d="M 72 157 L 75 162 L 78 157" stroke="var(--surface-tertiary)" stroke-width="1.5" fill="none" class="charge-icon"/>
                            </g>

                            <!-- LOCK INDICATOR (center top) -->
                            <g id="lock-indicator">
                                <circle cx="150" cy="60" r="15" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="lock-bg"/>
                                <path d="M 145 63 L 145 68 L 155 68 L 155 63 M 147 63 L 147 60 Q 147 56, 150 56 Q 153 56, 153 60 L 153 63" stroke="var(--surface-tertiary)" stroke-width="2" fill="none" class="lock-icon"/>
                            </g>

                            <!-- SENTRY MODE INDICATOR (center bottom) -->
                            <g id="sentry-indicator">
                                <circle cx="150" cy="440" r="15" fill="var(--surface-primary)" stroke="var(--surface-tertiary)" stroke-width="2" class="sentry-bg"/>
                                <circle cx="150" cy="437" r="7" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="2" class="sentry-eye"/>
                                <circle cx="150" cy="437" r="3" fill="var(--surface-tertiary)" class="sentry-pupil"/>
                            </g>

                            <!-- NIGHT MODE INDICATOR (top right corner) -->
                            <g id="night-mode-indicator">
                                <circle cx="260" cy="60" r="12" fill="transparent" stroke="var(--surface-tertiary)" stroke-width="2" class="night-mode-bg"/>
                                <path d="M 260 54 Q 265 60, 260 66 Q 252 60, 260 54" fill="var(--surface-tertiary)" class="night-mode-moon"/>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- DRIVE MODE (D/R/N) -->
            <div class="drive-mode" id="drive-mode">
                <!-- Left indicators -->
                <div class="left-indicators">
                    <div class="drive-indicator" id="ind-turn-left-drive" style="display: none;">
                        <svg width="40" height="40" viewBox="0 0 40 40">
                            <path d="M30 20 L10 20 M10 20 L18 12 M10 20 L18 28" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>

                <!-- Center speedometer with pedal arc -->
                <div class="speedometer-container">
                    <!-- Pedal position arc - 280° arc from -140° to +140° (0° = midi/top) -->
                    <!-- Center at (100,100), radius 70, stroke-width 10px -->
                    <svg class="pedal-arc" viewBox="0 0 200 200">
                        <path class="pedal-arc-bg" d="M 55.0 153.6 A 70 70 0 1 1 145.0 153.6" fill="none"/>
                        <path class="pedal-arc-fill" id="pedal-arc-fill" d="M 55.0 153.6 A 70 70 0 1 1 145.0 153.6" fill="none"/>
                    </svg>

                    <!-- Rear power arcs (left side) -->
                    <!-- Center at (100,100), radius 83 (70+10+3), stroke-width 5px -->
                    <svg class="power-arc power-arc-rear" viewBox="0 0 200 200">
                        <!-- Background: full arc from -140° to -30° -->
                        <path class="power-arc-bg" d="M 46.7 163.6 A 83 83 0 0 1 58.5 28.1" fill="none"/>
                        <!-- Positive power: -90° (0kW) to -30° (max, upwards) -->
                        <path class="power-arc-fill power-arc-positive" id="power-arc-rear-pos" d="M 17 100 A 83 83 0 0 1 58.5 28.1" fill="none"/>
                        <!-- Negative power/regen: -90° (0kW) to -140° (min, downwards) -->
                        <path class="power-arc-fill power-arc-negative" id="power-arc-rear-neg" d="M 17 100 A 83 83 0 0 0 46.7 163.6" fill="none"/>
                    </svg>

                    <!-- Front power arcs (right side) -->
                    <!-- Center at (100,100), radius 83 (70+10+3), stroke-width 5px -->
                    <svg class="power-arc power-arc-front" viewBox="0 0 200 200">
                        <!-- Background: full arc from +30° to +140° -->
                        <path class="power-arc-bg" d="M 141.5 28.1 A 83 83 0 0 1 153.3 163.6" fill="none"/>
                        <!-- Positive power: +90° (0kW) to +30° (max, upwards) -->
                        <path class="power-arc-fill power-arc-positive" id="power-arc-front-pos" d="M 183 100 A 83 83 0 0 0 141.5 28.1" fill="none"/>
                        <!-- Negative power/regen: +90° (0kW) to +140° (min, downwards) -->
                        <path class="power-arc-fill power-arc-negative" id="power-arc-front-neg" d="M 183 100 A 83 83 0 0 1 153.3 163.6" fill="none"/>
                    </svg>

                    <!-- Blindspot arcs on sides (further outside) -->
                    <svg class="blindspot-arcs-left" id="blindspot-arcs-left" viewBox="-40 0 280 200" style="display: none;">
                        <!-- Arcs centered around y=100, positioned further left -->
                        <path class="blindspot-lv1-1" d="M -5 110 A 110 110 0 0 1 -5 90" stroke="#ed8936" stroke-width="4" fill="none" opacity="0.7"/>
                        <path class="blindspot-lv1-2" d="M -10 115 A 115 115 0 0 1 -10 85" stroke="#ed8936" stroke-width="4" fill="none" opacity="0.85"/>
                        <path class="blindspot-lv1-3" d="M -15 120 A 120 120 0 0 1 -15 80" stroke="#ed8936" stroke-width="4" fill="none" opacity="1"/>
                    </svg>
                    <svg class="blindspot-arcs-right" id="blindspot-arcs-right" viewBox="-40 0 280 200" style="display: none;">
                        <!-- Arcs centered around y=100, positioned further right -->
                        <path class="blindspot-lv1-1" d="M 205 90 A 110 110 0 0 1 205 110" stroke="#ed8936" stroke-width="4" fill="none" opacity="0.7"/>
                        <path class="blindspot-lv1-2" d="M 210 85 A 115 115 0 0 1 210 115" stroke="#ed8936" stroke-width="4" fill="none" opacity="0.85"/>
                        <path class="blindspot-lv1-3" d="M 215 80 A 120 120 0 0 1 215 120" stroke="#ed8936" stroke-width="4" fill="none" opacity="1"/>
                    </svg>

                    <!-- Power & pedal map indicators around the speedometer -->
                    <div class="power-pedal-indicators">
                        <!-- Pedal map (drive mode) at top -->
                        <div class="pedal-map-indicator" id="pedal-map-indicator">
                            <div class="pedal-map-label">Standard</div>
                        </div>

                        <!-- Rear power at bottom-left -->
                        <div class="power-indicator power-rear" id="power-rear-indicator">
                            <div class="power-label">R</div>
                            <div class="power-value" id="power-rear-value">0</div>
                            <div class="power-unit">kW</div>
                        </div>

                        <!-- Front power at bottom-right -->
                        <div class="power-indicator power-front" id="power-front-indicator">
                            <div class="power-label">F</div>
                            <div class="power-value" id="power-front-value">0</div>
                            <div class="power-unit">kW</div>
                        </div>
                    </div>

                    <!-- Speed display -->
                    <div class="speed-display">
                        <div class="speed-large" id="speed-value-drive">0</div>
                        <div class="speed-unit-large">km/h</div>
                        <div class="gear-display-drive" id="gear-display-drive">D</div>
                    </div>

                    <!-- Battery & Odometer below -->
                    <div class="drive-info-compact">
                        <div class="drive-info-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" style="color: var(--text-primary);">
                                <rect x="3" y="6" width="12" height="8" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                <rect x="15" y="9" width="2" height="2" fill="currentColor"/>
                                <rect x="5" y="8" width="8" height="4" fill="currentColor" opacity="0.5"/>
                            </svg>
                            <span class="drive-info-value" id="battery-drive-compact">0%</span>
                        </div>
                        <div class="drive-info-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" style="color: var(--text-primary);">
                                <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                <circle cx="10" cy="10" r="2" fill="currentColor"/>
                            </svg>
                            <span class="drive-info-value" id="odometer-drive-compact">0km</span>
                        </div>
                    </div>
                </div>

                <!-- Right indicators -->
                <div class="right-indicators">
                    <div class="drive-indicator" id="ind-turn-right-drive" style="display: none;">
                        <svg width="40" height="40" viewBox="0 0 40 40">
                            <path d="M10 20 L30 20 M30 20 L22 12 M30 20 L22 28" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="drive-indicator" id="ind-blindspot-right-drive" style="display: none;">
                        <svg width="40" height="40" viewBox="0 0 40 40">
                            <path d="M30 30 Q30 10, 10 10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                            <circle cx="10" cy="10" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                </div>

                <!-- Bottom warnings (collision, brake, autopilot) -->
                <div class="bottom-warnings">
                    <div class="drive-indicator warning-indicator" id="ind-forward-collision-drive" style="display: none;">
                        <svg width="30" height="30" viewBox="0 0 30 30">
                            <path d="M15 5 L25 23 L5 23 Z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <text x="15" y="20" text-anchor="middle" fill="currentColor" font-size="14" font-weight="bold">!</text>
                        </svg>
                    </div>
                    <div class="drive-indicator warning-indicator" id="ind-brake-drive" style="display: none;">
                        <svg width="30" height="30" viewBox="0 0 30 30">
                            <circle cx="15" cy="15" r="12" stroke="currentColor" stroke-width="2.5" fill="none"/>
                            <circle cx="15" cy="15" r="5" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="drive-indicator autopilot-indicator" id="ind-autopilot-drive" style="display: none;">
                        <svg width="30" height="30" viewBox="0 0 30 30">
                            <circle cx="15" cy="15" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M10 15 L14 19 L20 11" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
